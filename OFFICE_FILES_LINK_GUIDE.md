# Office ファイル（Excel/Word/PowerPoint）へのリンク設定ガイド

このドキュメントは、Excel、Word、PowerPointファイルへのリンクを設定する際のベストプラクティスをまとめたものです。

## 📋 目次

1. [ファイルの保存先](#ファイルの保存先)
2. [リンクアドレスの設定方法](#リンクアドレスの設定方法)
3. [試行錯誤から得られた教訓](#試行錯誤から得られた教訓)
4. [推奨される設定方法](#推奨される設定方法)
5. [トラブルシューティング](#トラブルシューティング)

---

## ファイルの保存先

### ✅ 推奨される保存先

**H:/NEVの窓（管理部管理）/** 直下、またはそのサブフォルダ

```
H:/NEVの窓（管理部管理）/
├── 共通コーナー/
│   └── ロゴデータファイル.docx
├── 全職員向け_ポケットマニュアル.pptx
└── その他のファイル...
```

### ⚠️ 避けるべき保存先

- **相対パス**（セキュリティゾーンエラーが発生）
  - 例: `20240724_大規模災害時初動心得（全職員向け）\全職員向け_ポケットマニュアル.pptx`
  
- **深いサブフォルダ構造**（セキュリティ制限の可能性）
  - 例: `H:/NEVの窓（管理部管理）/20240724_大規模災害時初動心得（全職員向け）/全職員向け_ポケットマニュアル.pptx`

---

## リンクアドレスの設定方法

### 1. Excel ファイル (.xlsx, .xls, .xlsm, .xlsb)

**data.json での設定:**
```json
{
  "detail": "10階 会議室（R6年度）",
  "link": "H:/nev_window/room/R6_10F_Kaigi.xlsx"
}
```

**生成される HTML リンク:**
```html
<a href="ms-excel:ofv|u|H:/nev_window/room/R6_10F_Kaigi.xlsx">10階 会議室（R6年度）</a>
```

### 2. Word ファイル (.docx, .doc, .docm)

**data.json での設定:**
```json
{
  "detail": "★ロゴデータファイル",
  "link": "H:/NEVの窓（管理部管理）/共通コーナー/ロゴデータファイル.docx"
}
```

**生成される HTML リンク:**
```html
<a href="ms-word:ofv|u|H:/NEVの窓（管理部管理）/共通コーナー/ロゴデータファイル.docx">★ロゴデータファイル</a>
```

### 3. PowerPoint ファイル (.pptx, .ppt, .pptm)

**data.json での設定:**
```json
{
  "detail": "ポケット版",
  "link": "H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx"
}
```

**生成される HTML リンク:**
```html
<a href="ms-powerpoint:ofv|u|H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx">ポケット版</a>
```

---

## 試行錯誤から得られた教訓

### 🔍 発生した問題と解決策

#### 問題 1: セキュリティゾーンエラー

**エラーメッセージ:**
```
このファイルは制限付きサイトゾーンから入手したものです...
```

**原因:**
- 相対パスを使用していた
- `ms-powerpoint:ofv|u|20240724_大規模災害時初動心得（全職員向け）\全職員向け_ポケットマニュアル.pptx`

**解決策:**
- H:ドライブの絶対パスを使用する
- `ms-powerpoint:ofv|u|H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx`

#### 問題 2: プロトコルプレフィックスの重複

**問題:**
- data.json に `ms-powerpoint:ofv|u|` を含めると、generate_html.py が自動的に追加するため重複する
- 結果: `ms-powerpoint:ofv|u|H:/nev_window/ms-powerpoint:ofv|u|H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx`

**解決策:**
- data.json にはプロトコルを含めず、ファイルパスのみを記述する
- generate_html.py が拡張子に基づいて自動的に適切なプロトコルを追加する

#### 問題 3: パスの混乱

**試行錯誤の履歴:**
1. ❌ `H:/nev_window/20240724_大規模災害時初動心得（全職員向け）/...`
2. ❌ `H:/20240724_大規模災害時初動心得（全職員向け）/...`
3. ❌ `H:/NEVの窓（管理部管理）/20240724_大規模災害時初動心得（全職員向け）/...`
4. ✅ `H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx`

**教訓:**
- セキュリティ上の問題を避けるため、ファイルは信頼されたフォルダ（`H:/NEVの窓（管理部管理）/`）直下または浅い階層に配置する

---

## 推奨される設定方法

### ✨ ベストプラクティス

1. **ファイル配置**
   - すべての Office ファイルは `H:/NEVの窓（管理部管理）/` またはその直下のサブフォルダに配置
   - 深い階層構造は避ける

2. **data.json での記述**
   - プロトコル（`ms-excel:`, `ms-word:`, `ms-powerpoint:`）は含めない
   - ファイルパスのみを記述
   - generate_html.py が自動的にプロトコルを追加

3. **パス形式**
   - 絶対パス（H:ドライブ）を使用
   - スラッシュ（/）を使用（バックスラッシュも動作するが、統一性のため）

### 📝 設定例

**Excel ファイル:**
```json
{
  "date": "2025.10.24",
  "content": "会議室予約",
  "detail": "10階 会議室（R6年度）",
  "link": "H:/nev_window/room/R6_10F_Kaigi.xlsx"
}
```

**Word ファイル:**
```json
{
  "date": "2025.10.24",
  "content": "ロゴデータ",
  "detail": "★ロゴデータファイル",
  "link": "H:/NEVの窓（管理部管理）/共通コーナー/ロゴデータファイル.docx"
}
```

**PowerPoint ファイル:**
```json
{
  "date": "2024.7.24",
  "content": "大規模災害時初動心得（全職員向け）",
  "detail": "ポケット版",
  "link": "H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx"
}
```

---

## トラブルシューティング

### Q1: ファイルが開かない

**チェック項目:**
- [ ] ファイルパスが正しいか確認
- [ ] ファイルが実際に指定された場所に存在するか確認
- [ ] H:ドライブがマウントされているか確認
- [ ] ファイルのアクセス権限を確認

### Q2: セキュリティエラーが表示される

**対処方法:**
1. ファイルを `H:/NEVの窓（管理部管理）/` 直下に移動
2. data.json のリンクパスを更新
3. `python generate_html.py` を実行して HTML を再生成

### Q3: リンクが正しく生成されない

**確認事項:**
- data.json にプロトコル（`ms-excel:`, `ms-word:`, `ms-powerpoint:`）を含めていないか
- generate_html.py が最新版か
- ファイル拡張子が正しいか（`.xlsx`, `.docx`, `.pptx`）

---

## 📊 サポートされるファイル形式

| アプリケーション | 拡張子 | プロトコル |
|---------------|--------|----------|
| Excel | .xlsx, .xls, .xlsm, .xlsb | ms-excel:ofv\|u\| |
| Word | .docx, .doc, .docm | ms-word:ofv\|u\| |
| PowerPoint | .pptx, .ppt, .pptm | ms-powerpoint:ofv\|u\| |

---

## 🔄 更新フロー

1. Office ファイルを `H:/NEVの窓（管理部管理）/` に配置
2. `data.json` を編集してリンク情報を追加
3. `python generate_html.py` を実行
4. `index.html` が自動更新される
5. ブラウザで動作確認

---

## 📚 関連ドキュメント

- [OFFICE_URI_GUIDE.md](OFFICE_URI_GUIDE.md) - Office URI スキームの詳細
- [USER_GUIDE.md](USER_GUIDE.md) - ユーザーガイド
- [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md) - デプロイメントガイド

---

**更新日:** 2025-11-19  
**作成者:** GitHub Copilot  
**バージョン:** 1.0
