# NEVの窓 総合マニュアル

このドキュメントは、NEVの窓掲示板システムに関する全ての情報を一つにまとめた総合マニュアルです。

---

## 📑 目次

1. [システム概要](#システム概要)
2. [リンク一覧表](#リンク一覧表)
3. [Officeファイルリンク設定ガイド](#officeファイルリンク設定ガイド)
4. [Admin.html 使用ガイド](#adminhtml-使用ガイド)
5. [トラブルシューティング](#トラブルシューティング)

---

## システム概要

NEVの窓は、次世代自動車振興センター（NeV）の職員向け情報掲示板システムです。

### 主なファイル構成

- **index.html** - メインの掲示板ページ（全職員向け・職員向け情報の表示）
- **admin.html** - 管理者向け編集画面
- **data.json** - 掲示板データの保存ファイル
- **generate_html.py** - data.jsonからindex.htmlを生成するPythonスクリプト
- **admin.js** - admin.htmlの機能を実装するJavaScriptファイル

### 基本的な更新フロー

1. `admin.html`でデータを編集
2. 「data.jsonかきこみ」ボタンでdata.jsonをダウンロード
3. 元のdata.jsonファイルを置き換え
4. `python generate_html.py`を実行してindex.htmlを更新

---

## リンク一覧表

### 統計情報

| カテゴリ | リンク数 |
|---------|---------|
| 全員向け情報 | 58 |
| 職員向け情報 | 71 |
| **合計** | **129** |

### ファイル形式別統計

- **PDFファイル**: 104件
- **Excelファイル (.xlsx)**: 12件
- **Wordファイル (.docx)**: 2件
- **PowerPointファイル (.pptx)**: 1件
- **HTMLファイル**: 2件
- **フォルダ**: 8件

### 全員向け情報のセクション構成

1. **INFORMATION** - 最新のお知らせや重要情報
2. **カレンダー・組織情報** - 年度カレンダー、組織図など
3. **広報・資料** - ロゴデータ、パンフレットなど
4. **安全・防災** - 避難経路図、防災マップなど
5. **職場ルール・施設** - 就業ルール、施設利用案内など
6. **IT・在宅勤務・その他** - 在宅勤務マニュアル、倫理規定など
7. **会議室予約** - 各会議室の予約Excelファイル
8. **各部掲示板** - 各部署の座席表など

### 職員向け情報のセクション構成

1. **INFORMATION** - 職員向けの最新情報
2. **職員向け情報コーナー** - 各種規程、マニュアル
3. **標準書コーナー** - 6つのサブカテゴリに分類
   - ０．規則
   - １．稟議・契約
   - ２．組織・運営
   - ３．就業規則・出張・旅費他
   - ４．安全衛生他
   - ５．ITセキュリティ関係他
   - ６．その他
4. **各種帳票フォーマット** - 業務で使用する書類のテンプレート

### 詳細なリンク一覧

完全なリンク一覧表は **LINKS_TABLE.md** ファイルを参照してください。各リンクについて以下の情報が記載されています：

- セクション名
- サブセクション（該当する場合）
- 項目テキスト
- リンク先アドレス（完全なパス）
- ファイル形式

---

## Officeファイルリンク設定ガイド

Excel、Word、PowerPointファイルへのリンクを設定する際の推奨方法とベストプラクティスです。

### 📁 ファイルの保存先

#### ✅ 推奨される保存先

**H:/NEVの窓（管理部管理）/** 直下、またはそのサブフォルダ

```
H:/NEVの窓（管理部管理）/
├── 共通コーナー/
│   └── ロゴデータファイル.docx
├── 全職員向け_ポケットマニュアル.pptx
└── その他のファイル...
```

#### ⚠️ 避けるべき保存先

- **相対パス** - セキュリティゾーンエラーが発生します
  - 例: `20240724_大規模災害時初動心得（全職員向け）\全職員向け_ポケットマニュアル.pptx`
  
- **深いサブフォルダ構造** - セキュリティ制限の可能性があります
  - 例: `H:/NEVの窓（管理部管理）/深い/フォルダ/構造/ファイル.pptx`

### 🔗 リンクアドレスの設定方法

#### 1. Excel ファイル (.xlsx, .xls, .xlsm, .xlsb)

**data.json での設定:**
```json
{
  "detail": "10階 会議室（R6年度）",
  "link": "H:/nev_window/room/R6_10F_Kaigi.xlsx"
}
```

**生成されるHTML:**
```html
<a href="ms-excel:ofv|u|H:/nev_window/room/R6_10F_Kaigi.xlsx">10階 会議室（R6年度）</a>
```

#### 2. Word ファイル (.docx, .doc)

**data.json での設定:**
```json
{
  "text": "★ロゴデータファイル",
  "link": "H:/NEVの窓（管理部管理）/共通コーナー/ロゴデータファイル.docx"
}
```

**生成されるHTML:**
```html
<a href="ms-word:ofv|u|H:/NEVの窓（管理部管理）/共通コーナー/ロゴデータファイル.docx">★ロゴデータファイル</a>
```

#### 3. PowerPoint ファイル (.pptx, .ppt)

**data.json での設定:**
```json
{
  "detail": "ポケット版",
  "link": "H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx"
}
```

**生成されるHTML:**
```html
<a href="ms-powerpoint:ofv|u|H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx">ポケット版</a>
```

### 📝 重要なポイント

1. **data.jsonにはプロトコルプレフィックスを含めない**
   - ❌ 間違い: `"link": "ms-excel:ofv|u|H:/nev_window/room/R6_10F_Kaigi.xlsx"`
   - ✅ 正しい: `"link": "H:/nev_window/room/R6_10F_Kaigi.xlsx"`

2. **generate_html.pyが自動的にプロトコルを追加**
   - ファイル拡張子に基づいて自動的に適切なプロトコル（`ms-excel:`, `ms-word:`, `ms-powerpoint:`）が追加されます

3. **パスの区切り文字**
   - スラッシュ（`/`）とバックスラッシュ（`\`）のどちらでも動作しますが、スラッシュ（`/`）を推奨

### 🔍 試行錯誤から得られた教訓

#### 問題1: セキュリティゾーンエラー

**現象:**
```
このファイルは制限付きサイトゾーンから入手したものです...
```

**原因:**
- 相対パスを使用していた
- index.htmlと同じディレクトリにあるファイルへの相対パス

**解決策:**
- H:ドライブの絶対パスを使用
- ファイルを信頼されたフォルダ（`H:/NEVの窓（管理部管理）/`）に配置

#### 問題2: プロトコルプレフィックスの重複

**現象:**
- リンクが `ms-excel:ofv|u|ms-excel:ofv|u|...` のように重複

**原因:**
- data.jsonにすでにプロトコルが含まれているのに、generate_html.pyがさらに追加

**解決策:**
- data.jsonからプロトコルプレフィックスを削除
- generate_html.pyに任せる

#### 問題3: パスの混乱

**試行錯誤の変遷:**
1. `H:/nev_window/20240724_大規模災害時初動心得（全職員向け）/...` → セキュリティエラー
2. `20240724_大規模災害時初動心得（全職員向け）\...` → セキュリティエラー
3. `H:/20240724_大規模災害時初動心得（全職員向け）/...` → セキュリティエラー
4. `H:/NEVの窓（管理部管理）/20240724_大規模災害時初動心得（全職員向け）/...` → セキュリティエラー
5. `H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx` → ✅ 成功

**最終的な推奨:**
- ファイルを `H:/NEVの窓（管理部管理）/` 直下に配置
- シンプルなパス構造を維持

### 📋 推奨される設定手順

1. **ファイルの配置**
   ```
   ファイルを H:/NEVの窓（管理部管理）/ 直下または
   明確な目的のサブフォルダに配置
   ```

2. **data.jsonへの追加**
   ```json
   {
     "date": "2024.7.24",
     "content": "大規模災害時初動心得（全職員向け）",
     "detail": "ポケット版",
     "link": "H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx"
   }
   ```

3. **HTMLの生成**
   ```bash
   python generate_html.py
   ```

4. **動作確認**
   - ブラウザでindex.htmlを開く
   - リンクをクリックして該当のOfficeアプリケーションで開くことを確認

---

## Admin.html 使用ガイド

admin.htmlは、掲示板の内容を視覚的に編集できる管理画面です。

### 🚀 基本的な使い方

#### 1. データの読み込み

1. admin.htmlを開く
2. 「📂 初めに：data.jsonよみこみ」ボタンをクリック
3. data.jsonファイルを選択
4. データが読み込まれ、編集可能な状態になります

#### 2. タブの切り替え

- **全員向け** タブ: 全職員向けの情報を編集
- **職員向け** タブ: 職員向けの情報を編集

#### 3. セクションの管理

##### セクションの追加
1. 「➕ セクションを追加」ボタンをクリック
2. セクション名を入力
3. 「追加」ボタンをクリック

##### セクションの並び替え
- セクション名の右側にある「↑」「↓」ボタンで順序を変更

##### セクションの編集
- 「✏️ 編集」ボタンをクリックしてJSON形式で直接編集

##### セクションの削除
- 「🗑️」ボタンをクリックして削除（確認ダイアログが表示されます）

#### 4. 項目の管理

##### 項目の追加
1. セクションの下部にある「➕ 項目を追加」ボタンをクリック
2. 項目の情報を入力:
   - **日付** (任意): 例「2024.7.24」
   - **内容** (必須): メインの内容
   - **詳細** (任意): リンクテキスト
   - **リンク先** (任意): ファイルパスまたはURL
3. 「追加」ボタンをクリック

##### 項目にマウスホバーすると表示されるボタン

- **↑** - 項目を1つ上に移動
- **↓** - 項目を1つ下に移動
- **移動** - 別のセクションに移動
- **削除** - 項目を削除（確認ダイアログが表示されます）

#### 5. データの保存

1. すべての編集が完了したら「💾 最後に：data.jsonかきこみ」ボタンをクリック
2. 2つのファイルがダウンロードされます:
   - `data.json` - 更新されたデータファイル
   - `data_backup_YYYYMMDD_HHMMSS.json` - タイムスタンプ付きバックアップ
3. ダウンロードしたdata.jsonで元のファイルを置き換え
4. `python generate_html.py`を実行してindex.htmlを更新

### ⚙️ 高度な機能

#### JSON形式での直接編集

「✏️ 編集」ボタンをクリックすると、セクション全体をJSON形式で編集できます。

**例:**
```json
{
  "name": "INFORMATION",
  "items": [
    {
      "date": "2025.11.10",
      "content": "職場環境改善に向けた投書箱の設置",
      "detail": "投書箱（MSFORMS）",
      "link": "INFORMATION\\投書箱.pdf"
    },
    {
      "date": "2024.7.24",
      "content": "大規模災害時初動心得（全職員向け）",
      "detail": "ポケット版",
      "link": "H:/NEVの窓（管理部管理）/全職員向け_ポケットマニュアル.pptx"
    }
  ]
}
```

#### INFORMATIONセクションの特殊機能

INFORMATIONセクションでは、項目が多い場合に自動的に折りたたみ表示になります:
- 最初の3件が表示
- 「さらに表示 (N件)」ボタンで残りを表示

### 🐛 既知の問題と解決策

#### 問題: 項目追加後にボタンが消える

**現象:**
- 項目を追加した後、移動・削除ボタンが表示されない

**解決済み:**
- この問題は修正されました（commit 01e6b22）
- 現在は項目追加後も正常にボタンが表示されます

#### 問題: INFORMATIONセクションでボタンが消える

**現象:**
- 項目をINFORMATIONセクションに移動すると、移動・削除ボタンが表示されない

**解決済み:**
- この問題は修正されました（commit 10776c7）
- INFORMATIONセクションでも正常にボタンが表示されます

### 💡 ベストプラクティス

1. **定期的なバックアップ**
   - data.jsonかきこみ時に自動的にバックアップが作成されますが、重要な編集の前に手動でバックアップを取ることを推奨

2. **小さな変更を頻繁に保存**
   - 大量の変更を一度に行うのではなく、小さな変更を保存しながら進める

3. **テスト環境での確認**
   - 本番環境に反映する前に、テスト環境で動作を確認

4. **命名規則の統一**
   - ファイル名やセクション名は一貫した命名規則を使用

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. Officeファイルが開けない

**症状:**
- リンクをクリックしてもファイルが開かない
- エラーメッセージが表示される

**確認事項:**
```
✅ ファイルが存在するか確認
✅ パスが正しいか確認
✅ H:ドライブがマウントされているか確認
✅ ファイルへのアクセス権限があるか確認
```

**解決策:**
1. エクスプローラーで該当のパスを開いてファイルが存在することを確認
2. data.jsonのパスが正しいか確認
3. 必要に応じてファイルを推奨フォルダ（`H:/NEVの窓（管理部管理）/`）に移動

#### 2. セキュリティゾーンエラー

**症状:**
```
このファイルは制限付きサイトゾーンから入手したものです。
安全のために、このファイルへのアクセスはブロックされる可能性があります。
```

**原因:**
- 相対パスを使用している
- 信頼されていないフォルダにファイルがある

**解決策:**
1. ファイルを `H:/NEVの窓（管理部管理）/` 直下に移動
2. data.jsonのリンクを絶対パスに変更
3. generate_html.pyを再実行

#### 3. プロトコルが重複する

**症状:**
- リンクが `ms-excel:ofv|u|ms-excel:ofv|u|...` のように重複

**原因:**
- data.jsonにすでにプロトコルプレフィックスが含まれている

**解決策:**
1. data.jsonを開く
2. `ms-excel:`, `ms-word:`, `ms-powerpoint:` プレフィックスを削除
3. パスのみを残す
4. generate_html.pyを再実行

#### 4. Admin.htmlでボタンが表示されない

**症状:**
- 項目にマウスホバーしても移動・削除ボタンが表示されない

**原因:**
- 最新のadmin.jsが適用されていない可能性

**解決策:**
1. ブラウザのキャッシュをクリア（Ctrl + F5）
2. admin.htmlを再読み込み
3. それでも解決しない場合は、admin.jsが最新バージョンか確認

#### 5. data.jsonの構文エラー

**症状:**
- generate_html.pyでエラーが発生
- admin.htmlでデータが読み込めない

**確認事項:**
```json
✅ カンマの位置が正しいか
✅ 引用符が正しく閉じられているか
✅ 全角文字が混入していないか（文字列内を除く）
✅ 最後の要素の後にカンマがないか
```

**解決策:**
1. JSONバリデーターでdata.jsonを検証
2. エラー箇所を修正
3. バックアップから復元（必要に応じて）

### チェックリスト

新しいOfficeファイルリンクを追加する際のチェックリスト:

- [ ] ファイルを `H:/NEVの窓（管理部管理）/` またはそのサブフォルダに配置
- [ ] data.jsonに追加（プロトコルプレフィックスなし）
- [ ] パスが正しいことを確認
- [ ] generate_html.pyを実行
- [ ] index.htmlでリンクが正しく生成されているか確認
- [ ] リンクをクリックしてファイルが開くことを確認
- [ ] LINKS_TABLE.mdを更新（必要に応じて）

---

## 付録

### 関連ファイル

- **LINKS_TABLE.md** - 全リンクの詳細一覧表
- **OFFICE_FILES_LINK_GUIDE.md** - Officeファイルリンク設定の詳細ガイド
- **リンク整理について.md** - リンク整理作業の概要

### 更新履歴

- 2025.11.21 - セクション名変更後もINFORMATION形式の折りたたみ機能を維持するよう修正
- 2025.11.19 - 総合マニュアル作成
- 2025.11.19 - Admin.htmlにセクション名編集機能を追加
- 2025.11.18 - Admin.htmlバグ修正（INFORMATIONセクション対応）
- 2025.11.18 - Admin.htmlバグ修正（項目移動時のボタン表示）
- 2025.11.18 - Officeファイルリンク設定ガイド作成
- 2025.11.17 - リンク一覧表作成
- 2025.11.17 - ポケット版・ITセキュリティ教材リンク追加

---

**© 2025 NEV - Next-Generation Vehicle Promotion Center**
